!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.ValidateRules=e()}(this,(function(){var t,e,n,r,i,u,s=(t={attribute:"data-rules"},(e=function(e,n){var r=0;this.id=function(){return r++},this.form=e,this.rules={},this.opts=Object.assign({},t,n),this.init()}).prototype={init:function(){var t,e,n,r=this.$("["+this.opts.attribute+"]");for(t=0;t<r.length;t++)e=this,n=r[t],e.rules[""==n.id?e.id():n.id]=new s.Context(n,e);for(t in this.rules)this.rules[t].setup()},values:function(){var t,e=[];for(t in this.rules)e.push(this.rules[t].content());return e},validate:function(){var t,e=!0;for(t in this.rules)e=this.rules[t].validate()&&e;return e},$:function(t){return this.form.querySelectorAll(t)},$$:function(t){return this.form.querySelector(t)}},e);return s.funcs={value:function(t){var e=t.selector();return null===e?function(){return t.context.element().value}:function(){return t.context.$$(e).value}},length:function(t){var e=t.selector();return null===e?function(){return t.context.element().value.length}:function(){return t.context.$$(e).value.length}},content:function(t){var e=t.args((function(){return t.id()}));return null===e?function(){return t.context.content()}:function(){return t.context.form.rules[e].content()}},empty:function(t){const e=t.selector();if(null===e)return()=>""==t.context.content();if("@"===e[0])return()=>t.context.form.rules[e.slice(1)].content();const n=t.context.$$(e);return()=>["checkbox","radio"].indexOf(n.type)>-1?!n.checked:""==n.value},valid:function(t){var e=t.args((function(){return t.id()}));if(null===e)throw"Parse error: <id> required";return function(){return!0===t.context.form.rules[e].check()}},email:function(t){var e=t.selector();return function(){var n=null===e?t.context.content().trim():t.context.$$(e).value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)}},pattern:function(t){var e=t.regex();return function(){return e.test(t.context.content().trim())}}},s.props={element:{self:function(){return function(t){t.element=function(){return-1!=["input","select","textarea"].indexOf(t.root.tagName.toLowerCase())?t.root:t.$$("input,select,textarea")}}},query:function(t){var e=t.selector();if(null===e)throw"Parse error: <missing selector>";return function(t){t.element=function(){return t.$$(e)}}}},content:function(t){var e=t.expression.parse();return function(t){t.content=e}}},s.Context=function(){var t={element:s.props.element.self(),content:function(t){if(t.element().type)switch(t.element().type){case"radio":case"checkbox":return void(t.content=function(){return t.element().checked?"on":""})}t.content=function(){return t.element().value}}},e=function(e,n){this.form=n,this.root=e,this.content=null,this.tests={},this.opts=Object.assign({},t),this.parse()};return e.prototype={parse:function(){this.processor=new s.Processor(this),this.processor.parse()},definition:function(){return this.root.getAttribute(this.form.opts.attribute)},setup:function(){for(var t in this.opts)this.opts[t].call&&this.opts[t](this)},validate:function(){var t;return this.reset(),!0===(t=this.check())||(this.alert(t),!1)},check:function(){for(var t in this.tests)if(this.tests[t].call&&!0!==this.tests[t]())return t;return!0},alert:function(t){var e=this.root.querySelector("label.err-"+t);null!==e&&e.classList.add("err-visible")},reset:function(){for(var t=this.root.querySelectorAll("label.err-visible"),e=0;e<t.length;e++)t[e].classList.remove("err-visible")},$:function(t){return this.root.querySelectorAll(t)},$$:function(t){return this.root.querySelector(t)}},e}(),s.Expression=(n=function(t,e){return function(n,r){n.shift(),r.unshift(t.apply(null,r.splice(0,e)))}},r={"(":[10,70,function(t,e){}],"!":[20,20,n((function(t){return function(){return!t()}}),1)],"*":[30,30,n((function(t,e){return function(){return e()*t()}}),2)],"/":[30,30,n((function(t,e){return function(){return e()/t()}}),2)],"+":[40,40,n((function(t,e){return function(){return e()+t()}}),2)],"-":[40,40,function(t,e){t[0]="+",e.unshift((function(t){return function(t){return-t()}}))(e.shift())}],">=":[50,50,n((function(t,e){return function(){return e()>=t()}}),2)],"<=":[50,50,n((function(t,e){return function(){return e()<=t()}}),2)],">":[50,50,n((function(t,e){return function(){return e()>t()}}),2)],"<":[50,50,n((function(t,e){return function(){return e()<t()}}),2)],"!=":[50,50,n((function(t,e){return function(){return e()!=t()}}),2)],"==":[50,50,n((function(t,e){return function(){return e()==t()}}),2)],"||":[60,60,n((function(t,e){return function(){return e()||t()}}),2)],"&&":[60,60,n((function(t,e){return function(){return e()&&t()}}),2)],")":[70,10,function(t,e){t.splice(0,2)}]},(i=function(t){this.processor=t,this.lexer=t.lexer}).prototype={parse:function(){var t=null,e=!1,n=[],i=[],u=function(t,e){return e=e||n[0],!!r[e]&&(void 0===t||!!r[e][t]&&r[e][t])};do{if(null===t&&!e)if(null===(t=this.lexer.next())||";"==t.value)t=null,e=!0;else switch(t.type){case s.Lexer.IDENTIFIER:if(!s.funcs[t.value])throw"Parse error: unknown function <"+t.value+">";i.unshift(s.funcs[t.value](this.processor)),t=null;continue;case s.Lexer.QUOTE:case s.Lexer.NUMBER:i.unshift(function(t){return function(){return t}}(t.value)),t=null;continue}null===t||u()&&!(u(1)>=u(0,t.value))?u()&&u(2)(n,i):(n.unshift(t.value),t=null)}while(n.length||!e);return i[0]}},i),s.Processor=((u=function(t){this.context=t,this.lexer=new s.Lexer(t.definition()),this.expression=new s.Expression(this)}).prototype={parse:function(){for(var t;null!=(t=this.property());)s.props[t]?s.props[t].call?this.context.opts[t]=s.props[t](this):this.context.opts[t]=s.props[t][this.id()](this):this.context.tests[t]=this.expression.parse()},skip:function(){do{var t=this.lexer.token()}while(null!==t&&";"!==t.value)},selector:function(){return this.args(function(){return this.lexer.with("space",function(){var t=1,e="";do{switch(this.lexer.read()){case"(":t++;break;case")":t--;break;case null:return e;default:e+=this.lexer.next().value}}while(t);return e}.bind(this))}.bind(this))},id:function(){return this.lexer.with("dash",function(){var t=this.lexer.next();if(null===t)return null;if(t.type!=s.Lexer.IDENTIFIER)throw"Parse error: IDENTIFIER expected";return t.value}.bind(this))},property:function(){if(this.lexer.end())return null;var t=this.id();if(":"!=this.lexer.next().value)throw"Parse error: ':' expected.";return t},args:function(t){if("("!==this.lexer.read())return null;this.lexer.pos++;var e=t();if(")"!==this.lexer.read())throw"Parse error: ')' expected";return this.lexer.pos++,e},regex:function(){var t,e=!1,n="";if("("===this.lexer.next().value&&(e=!0),"/"!==this.lexer.next().value)throw"Parse error: </> expected";for(;!this.lexer.end()&&"/"!=(t=this.lexer.read());)"\\"==t&&(n+=t,this.lexer.pos++),n+=this.lexer.read(),this.lexer.pos++;if(this.lexer.pos++,e&&")"!==this.lexer.next().value)throw"Parse error: <)> expected";return new RegExp(n)}},u),s.Lexer=function(){var t=function(t){this.setup(t)};t.OPERATOR=1,t.IDENTIFIER=2,t.QUOTE=3,t.NUMBER=4,t.WHITESPACE=5;var e=function(t,e,n){return{type:t,value:e,pos:n}},n={s:function(n){return e(t.OPERATOR,n.read(),n.pos++)},d:function(n){return function(r){var i=r.read(),u=r.read(1);return-1!=n.indexOf(u)&&(i+=u,r.pos++),e(t.OPERATOR,i,r.pos++)}}};n.avail={"+":n.d(["+"]),"-":n.d(["-"]),"*":n.s,".":n.s,"\\":n.s,":":n.s,"%":n.s,"|":n.d(["|"]),"!":n.s,"?":n.s,"#":n.s,"&":n.d(["&"]),";":n.s,",":n.s,"(":n.s,")":n.s,"<":n.d(["="]),">":n.d(["="]),"{":n.s,"}":n.s,"[":n.s,"]":n.s,"=":n.d(["="]),"/":n.s};var r="\n\t\r ".split(""),i="\n\t\r".split(""),u=function(t){return t.space?i:r},s={n:function(t){return t>="0"&&t<="9"},q:function(t){return'"'===t||"'"===t},c:function(t){return function(e){return t==e}},v:function(t){return"_"===t||"$"===t||"@"===t},a:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||s.v(t)},w:function(t){return" "===t||"\t"===t},an:function(t){return function(e){return s.n(e)||s.a(e)||!!t&&"-"==e}},with:function(t,e){for(var n,r=1;""!==(n=t.read(r))&&e(n);)r++;return t.chunk(r)}};return t.prototype={setup:function(t){this.pos=0,this.exp=null,this.to=null,this.space=!1,this.dash=!1,this.buf=void 0!==t?t:null,this.len=null!==this.buf?this.buf.length:0},next:function(){if(function(t){for(;t.pos<t.len;){if(-1==u(t).indexOf(t.read()))return;t.pos++}}(this),this.end())return null;var r,i=this.read();switch(!0){case s.n(i):return r=s.with(this,s.n),"."===this.read()?(this.pos++,r+=".".test.with(this,s.n),e(t.NUMBER,parseFloat(r),this.pos)):e(t.NUMBER,parseInt(r),this.pos);case s.q(i):for(var o,c=1;""!==(o=this.read(c))&&i!==o;)c++;return e(t.QUOTE,this.chunk(c-1,1),this.pos+=2);case s.a(i):return r=s.with(this,s.an(this.dash)),e(t.IDENTIFIER,r,this.pos);case s.w(i):return r=s.with(this,s.w),e(t.IDENTIFIER,r,this.pos);default:if(n.avail[i])return n.avail[i](this)}throw"Parse error"},end:function(){return this.pos>=this.len},read:function(t){return this.buf.charAt(this.pos+(0|t))},chunk:function(t,e){var n=this.buf.substr(this.pos+(0|e),t);return this.pos+=t,n},with:function(t,e){this[t]=!0;var n=e();return this[t]=!1,n},to:function(t){for(var e=1;t!==this.read(e);)e++;return this.chunk(e-1,1)}},t}(),s}));
