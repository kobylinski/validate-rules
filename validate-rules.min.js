!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.ValidateRules=b()}(this,function(){var a=function(){var b={attribute:"data-rules"},c=function(b,c){b.rules[""==c.id?b.id():c.id]=new a.Context(c,b)},d=function(a,c){var d=0;this.id=function(){return d++},this.form=a,this.rules={},this.opts=Object.assign({},b,c),this.init()};return d.prototype={init:function(){var a,b=this.$("["+this.opts.attribute+"]");for(a=0;a<b.length;a++)c(this,b[a]);for(a in this.rules)this.rules[a].setup()},values:function(){var a,b=[];for(a in this.rules)b.push(this.rules[a].content());return b},validate:function(){var a,b=!0;for(a in this.rules)b=this.rules[a].validate()&&b;return b},$:function(a){return this.form.querySelectorAll(a)},$$:function(a){return this.form.querySelector(a)}},d}();return a.funcs={value:function(a){var b=a.selector();return null===b?function(){return a.context.element().value}:function(){return a.context.$$(b).value}},length:function(a){var b=a.selector();return null===b?function(){return a.context.element().value.length}:function(){return a.context.$$(b).value.length}},content:function(a){var b=a.args(function(){return a.id()});return null===b?function(){return a.context.content()}:function(){return a.context.form.rules[b].content()}},empty:function(a){var b=a.selector();return null===b?function(){return""==a.context.content()}:function(){var c=a.context.$$(b);return["checkbox","radio"].indexOf(c.type)>-1?!c.checked:""==c.value}},valid:function(a){var b=a.args(function(){return a.id()});if(null===b)throw"Parse error: <id> required";return function(){return!0===a.context.form.rules[b].check()}},email:function(a){var b=a.selector();return function(){var c=null===b?a.context.content().trim():a.context.$$(b).value;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(c)}},pattern:function(a){var b=a.regex();return function(){return b.test(a.context.content().trim())}}},a.props={element:{self:function(){return function(a){a.element=function(){return["input","select","textarea"].indexOf(a.root.tagName.toLowerCase())!=-1?a.root:a.$$("input,select,textarea")}}},query:function(a){var b=a.selector();if(null===b)throw"Parse error: <missing selector>";return function(a){a.element=function(){return a.$$(b)}}}},content:function(a){var b=a.expression.parse();return function(a){a.content=b}}},a.Context=function(){var b={element:a.props.element.self(),content:function(a){var b=a.element().type;if(b)switch(a.element().type){case"radio":case"checkbox":return void(a.content=function(){return a.element().checked?"on":""})}a.content=function(){return a.element().value}}},c=function(a,c){this.form=c,this.root=a,this.content=null,this.tests={},this.opts=Object.assign({},b),this.parse()};return c.prototype={parse:function(){this.processor=new a.Processor(this),this.processor.parse()},definition:function(){return this.root.getAttribute(this.form.opts.attribute)},setup:function(){for(var a in this.opts)this.opts[a].call&&this.opts[a](this)},validate:function(){var a;return this.reset(),!0===(a=this.check())||(this.alert(a),!1)},check:function(){for(var a in this.tests)if(this.tests[a].call&&!0!==this.tests[a]())return a;return!0},alert:function(a){var b=this.root.querySelector("label.err-"+a);null!==b&&b.classList.add("err-visible")},reset:function(){for(var a=this.root.querySelectorAll("label.err-visible"),b=0;b<a.length;b++)a[b].classList.remove("err-visible")},$:function(a){return this.root.querySelectorAll(a)},$$:function(a){return this.root.querySelector(a)}},c}(),a.Expression=function(){var b=function(a,b){return function(c,d){c.shift(),d.unshift(a.apply(null,d.splice(0,b)))}},c={"(":[10,70,function(a,b){}],"!":[20,20,b(function(a){return function(){return!a()}},1)],"*":[30,30,b(function(a,b){return function(){return b()*a()}},2)],"/":[30,30,b(function(a,b){return function(){return b()/a()}},2)],"+":[40,40,b(function(a,b){return function(){return b()+a()}},2)],"-":[40,40,function(a,b){a[0]="+",b.unshift(function(a){return function(a){return-a()}})(b.shift())}],">=":[50,50,b(function(a,b){return function(){return b()>=a()}},2)],"<=":[50,50,b(function(a,b){return function(){return b()<=a()}},2)],">":[50,50,b(function(a,b){return function(){return b()>a()}},2)],"<":[50,50,b(function(a,b){return function(){return b()<a()}},2)],"!=":[50,50,b(function(a,b){return function(){return b()!=a()}},2)],"==":[50,50,b(function(a,b){return function(){return b()==a()}},2)],"||":[60,60,b(function(a,b){return function(){return b()||a()}},2)],"&&":[60,60,b(function(a,b){return function(){return b()&&a()}},2)],")":[70,10,function(a,b){a.splice(0,2)}]},d=function(a){this.processor=a,this.lexer=a.lexer};return d.prototype={parse:function(){var b=null,d=!1,e=[],f=[],g=function(a,b){var b=b||e[0];return!!c[b]&&("undefined"==typeof a||!!c[b][a]&&c[b][a])};do{if(null===b&&!d)if(b=this.lexer.next(),null===b||";"==b.value)b=null,d=!0;else switch(b.type){case a.Lexer.IDENTIFIER:if(!a.funcs[b.value])throw"Parse error: unknown function <"+b.value+">";f.unshift(a.funcs[b.value](this.processor)),b=null;continue;case a.Lexer.QUOTE:case a.Lexer.NUMBER:f.unshift(function(a){return function(){return a}}(b.value)),b=null;continue}null===b||g()&&!(g(1)>=g(0,b.value))?g()&&g(2)(e,f):(e.unshift(b.value),b=null)}while(e.length||!d);return f[0]}},d}(),a.Processor=function(){var b=function(b){this.context=b,this.lexer=new a.Lexer(b.definition()),this.expression=new a.Expression(this)};return b.prototype={parse:function(){for(var b;null!=(b=this.property());)a.props[b]?a.props[b].call?this.context.opts[b]=a.props[b](this):this.context.opts[b]=a.props[b][this.id()](this):this.context.tests[b]=this.expression.parse()},skip:function(){do var a=this.lexer.token();while(null!==a&&";"!==a.value)},selector:function(){return this.args(function(){return this.lexer.with("space",function(){var a=1,b="";do switch(this.lexer.read()){case"(":a++;break;case")":a--;break;case null:return b;default:b+=this.lexer.next().value}while(a);return b}.bind(this))}.bind(this))},id:function(){return this.lexer.with("dash",function(){var b=this.lexer.next();if(null===b)return null;if(b.type!=a.Lexer.IDENTIFIER)throw"Parse error: IDENTIFIER expected";return b.value}.bind(this))},property:function(){if(this.lexer.end())return null;var a=this.id();if(":"!=this.lexer.next().value)throw"Parse error: ':' expected.";return a},args:function(a){if("("!==this.lexer.read())return null;this.lexer.pos++;var b=a();if(")"!==this.lexer.read())throw"Parse error: ')' expected";return this.lexer.pos++,b},regex:function(){var a,b=!1,c="";if("("===this.lexer.next().value&&(b=!0),"/"!==this.lexer.next().value)throw"Parse error: </> expected";for(;!this.lexer.end()&&"/"!=(a=this.lexer.read());)"\\"==a&&(c+=a,this.lexer.pos++),c+=this.lexer.read(),this.lexer.pos++;if(this.lexer.pos++,b&&")"!==this.lexer.next().value)throw"Parse error: <)> expected";return new RegExp(c)}},b}(),a.Lexer=function(){var a=function(a){this.setup(a)};a.OPERATOR=1,a.IDENTIFIER=2,a.QUOTE=3,a.NUMBER=4,a.WHITESPACE=5;var b=function(a,b,c){return{type:a,value:b,pos:c}},c={s:function(c){return b(a.OPERATOR,c.read(),c.pos++)},d:function(c){return function(d){var e=d.read(),f=d.read(1);return c.indexOf(f)!=-1&&(e+=f,d.pos++),b(a.OPERATOR,e,d.pos++)}}};c.avail={"+":c.d(["+"]),"-":c.d(["-"]),"*":c.s,".":c.s,"\\":c.s,":":c.s,"%":c.s,"|":c.d(["|"]),"!":c.s,"?":c.s,"#":c.s,"&":c.d(["&"]),";":c.s,",":c.s,"(":c.s,")":c.s,"<":c.d(["="]),">":c.d(["="]),"{":c.s,"}":c.s,"[":c.s,"]":c.s,"=":c.d(["="]),"/":c.s};var d="\n\t\r ".split(""),e="\n\t\r".split(""),f=function(a){return a.space?e:d},g=function(a){for(;a.pos<a.len;){if(f(a).indexOf(a.read())==-1)return;a.pos++}},h={n:function(a){return a>="0"&&a<="9"},q:function(a){return'"'===a||"'"===a},c:function(a){return function(b){return a==b}},v:function(a){return"_"===a||"$"===a},a:function(a){return a>="a"&&a<="z"||a>="A"&&a<="Z"||h.v(a)},w:function(a){return" "===a||"\t"===a},an:function(a){return function(b){return h.n(b)||h.a(b)||!!a&&"-"==b}},with:function(a,b){for(var c,d=1;""!==(c=a.read(d))&&b(c);)d++;return a.chunk(d)}};return a.prototype={setup:function(a){this.pos=0,this.exp=null,this.to=null,this.space=!1,this.dash=!1,this.buf="undefined"!=typeof a?a:null,this.len=null!==this.buf?this.buf.length:0},next:function(){if(g(this),this.end())return null;var d,e=this.read();switch(!0){case h.n(e):return d=h.with(this,h.n),"."===this.read()?(this.pos++,d+=".".test.with(this,h.n),b(a.NUMBER,parseFloat(d),this.pos)):b(a.NUMBER,parseInt(d),this.pos);case h.q(e):for(var f,i=1;""!==(f=this.read(i))&&e!==f;)i++;return b(a.QUOTE,this.chunk(i-1,1),this.pos+=2);case h.a(e):return d=h.with(this,h.an(this.dash)),b(a.IDENTIFIER,d,this.pos);case h.w(e):return d=h.with(this,h.w),b(a.IDENTIFIER,d,this.pos);default:if(c.avail[e])return c.avail[e](this)}throw"Parse error"},end:function(){return this.pos>=this.len},read:function(a){return this.buf.charAt(this.pos+(0|a))},chunk:function(a,b){var c=this.buf.substr(this.pos+(0|b),a);return this.pos+=a,c},with:function(a,b){this[a]=!0;var c=b();return this[a]=!1,c},to:function(a){for(var b,c=1;a!==(b=this.read(c));)c++;return this.chunk(c-1,1)}},a}(),a});